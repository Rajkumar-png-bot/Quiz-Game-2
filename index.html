<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Quiz Game (Advanced)</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter&family=Noto+Sans+Devanagari:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="manifest" href="manifest.json">
<style>
/* Ensures the entire page takes up the full viewport height */
html, body {
height: 100%;
width: 100%;
margin: 0;
padding: 0;
overflow: hidden; /* Prevents scrolling on mobile */
}
body {
font-family: 'Noto Sans Devanagari', 'Inter', sans-serif;
background-color: #0d1117;
color: #ffffff;
display: flex;
justify-content: center;
align-items: center;
background-image: linear-gradient(to bottom right, #1a202c, #4a044e, #1a202c);
}
.card {
background-color: rgba(255, 255, 255, 0.05);
backdrop-filter: blur(10px);
border: 1px solid rgba(255, 255, 255, 0.1);
max-height: 95%;
overflow-y: auto;
}
.btn {
transition: all 0.3s ease;
}
.btn:hover {
transform: translateY(-2px);
box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}
.option-btn.correct {
background-color: #22c55e !important;
border-color: #16a34a !important;
color: white !important;
}
.option-btn.incorrect {
background-color: #ef4444 !important;
border-color: #dc2626 !important;
color: white !important;
}
.option-btn:disabled {
cursor: not-allowed;
opacity: 0.7;
}
#topic-history li {
cursor: pointer;
transition: background-color 0.2s;
}
#topic-history li:hover {
background-color: #4a044e;
}
#timer-display {
font-size: 1.2rem;
font-weight: bold;
color: #facc15;
transition: color 0.5s ease-in-out;
}
#timer-display.low-time {
color: #ef4444;
}


#side-menu {
transition: transform 0.3s ease-in-out;
width: 100%;
height: 100%;
max-width: 100vw;
}
#side-menu.open {
transform: translateX(0);
}
#menu-content p {
margin-bottom: 1rem;
}
#menu-content p:last-child {
margin-bottom: 0;
}


#game-wrapper {
/* This is the key change to make the game fill the screen */
width: 100vw;
height: 100vh;
display: flex;
justify-content: center;
align-items: center;
padding: 1rem;
box-sizing: border-box;
}


#app-container {
width: 100%;
max-width: 450px;
aspect-ratio: 9 / 16;
background-color: rgba(0, 0, 0, 0.2);
border-radius: 1.5rem;
box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
padding: 1rem;
display: flex;
flex-direction: column;
justify-content: center;
}


@keyframes glow {
0% { box-shadow: 0 0 8px #34d399, 0 0 15px #34d399, 0 0 25px #34d399; }
50% { box-shadow: 0 0 25px #10b981, 0 0 40px #10b981, 0 0 60px #10b981; }
100% { box-shadow: 0 0 8px #34d399, 0 0 15px #34d399, 0 0 25px #34d399; }
}
.whatsapp-glow-btn {
animation: glow 1.5s infinite alternate;
background-color: #10b981;
}


@keyframes half-glow {
0% { box-shadow: 0 0 4px #34d399, 0 0 7px #34d399; }
50% { box-shadow: 0 0 10px #10b981, 0 0 15px #10b981; }
100% { box-shadow: 0 0 4px #34d399, 0 0 7px #34d399; }
}
.whatsapp-half-glow-btn {
animation: half-glow 1.5s infinite alternate;
background-color: #10b981;
}


@media (max-width: 640px) {
#main-title { font-size: 2.5rem; }
#main-subtitle { font-size: 1rem; }
#menu-title { font-size: 2rem; }
#close-menu-btn { font-size: 2rem; }
#menu-content-title { font-size: 1.25rem; }
#menu-content-text { font-size: 0.875rem; }
#quiz-screen .p-6 { padding: 1rem; }
#question-text { font-size: 1.1rem; }
#final-score-text .text-4xl { font-size: 2.5rem; }
.p-8 { padding: 2rem; }
}
</style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900">
<div id="game-wrapper">
<div id="app-container">
<div id="menu-button-container" class="fixed top-4 left-4 z-50">
<button id="menu-toggle-btn" class="p-2 rounded-full bg-purple-700 hover:bg-purple-800 text-white shadow-lg focus:outline-none">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
</button>
</div>


<div id="side-menu" class="fixed inset-0 bg-gray-900 bg-opacity-95 z-50 hidden transform -translate-x-full transition-transform duration-300 ease-in-out overflow-y-auto">
<div class="p-6 text-right">
<button id="close-menu-btn" class="text-white text-3xl font-bold focus:outline-none">&times;</button>
</div>
<div class="p-6">
<h2 id="menu-title" class="text-3xl font-bold text-purple-400 mb-6 text-center"></h2>
<ul class="space-y-4 text-center">
<li><button id="menu-home-btn" class="text-xl text-white hover:text-purple-300 focus:outline-none font-bold underline"></button></li>
<li><button id="menu-description-btn" class="text-xl text-white hover:text-purple-300 focus:outline-none font-bold underline"></button></li>
<li><button id="menu-help-btn" class="text-xl text-white hover:text-purple-300 focus:outline-none font-bold underline"></button></li>
</ul>


<div id="menu-content" class="mt-8 p-4 bg-gray-800/50 rounded-lg max-w-lg mx-auto">
<h3 id="menu-content-title" class="text-2xl font-semibold text-pink-300 mb-4 text-center"></h3>
<div id="menu-content-text" class="text-gray-300 leading-relaxed"></div>
</div>
</div>
</div>


<div id="language-selection-screen" class="p-8 rounded-2xl shadow-2xl card text-center">
<h1 class="text-4xl md:text-5xl font-bold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-500">Welcome!</h1>
<p class="text-gray-300 mb-8 text-base">Please select your language / कृपया अपनी भाषा चुनें</p>
<div class="flex flex-col sm:flex-row gap-4 justify-center">
<button id="lang-en-btn" class="w-full sm:w-auto bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-lg text-lg btn shadow-lg">English</button>
<button id="lang-hi-btn" class="w-full sm:w-auto bg-pink-600 hover:bg-pink-700 text-white font-bold py-3 px-8 rounded-lg text-lg btn shadow-lg">हिन्दी</button>
</div>
</div>


<div id="start-screen" class="hidden p-8 rounded-2xl shadow-2xl card">
<h1 id="main-title" class="text-3xl md:text-4xl font-bold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-500"></h1>
<p id="main-subtitle" class="text-gray-300 text-base md:text-lg mb-6"></p>


<div class="space-y-4 mb-6">
<input type="text" id="topic-input" class="w-full bg-gray-800 text-white placeholder-gray-400 border-2 border-gray-700 rounded-lg py-3 px-4 text-center text-base md:text-lg focus:outline-none focus:border-purple-500 transition-colors" aria-label="Enter quiz topic">
<input type="number" id="questions-count-input" class="w-full bg-gray-800 text-white placeholder-gray-400 border-2 border-gray-700 rounded-lg py-3 px-4 text-center text-base md:text-lg focus:outline-none focus:border-purple-500 transition-colors" min="1" max="500" aria-label="Number of questions">
<label for="difficulty-input" id="difficulty-label" class="block text-gray-300 text-sm font-bold mb-2 sr-only"></label>
<select id="difficulty-input" class="w-full bg-gray-800 text-white border-2 border-gray-700 rounded-lg py-3 px-4 text-center text-base md:text-lg focus:outline-none focus:border-purple-500 transition-colors" aria-labelledby="difficulty-label">
<option value="easy">Easy / आसान</option>
<option value="medium">Medium / मध्यम</option>
<option value="hard">Hard / कठिन</option>
</select>
</div>


<button id="start-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg text-lg md:text-xl btn shadow-lg mb-6"></button>


<div id="history-container" class="mt-6 text-left">
<h3 id="history-title" class="text-base font-semibold text-purple-300 mb-2"></h3>
<ul id="topic-history" class="max-h-32 overflow-y-auto bg-gray-800/50 rounded-lg p-2 text-sm">
</ul>
</div>
</div>


<div id="quiz-screen" class="hidden p-6 rounded-2xl shadow-2xl card">
<div class="flex justify-between items-center mb-4">
<p id="progress-text" class="text-base md:text-lg text-gray-300"></p>
<p id="timer-display" class="text-lg font-bold text-yellow-400"></p>
<p id="score-display" class="text-base md:text-lg font-bold text-purple-400"></p>
</div>
<div id="question-container" class="bg-gray-800/50 p-4 rounded-lg mb-4 min-h-[80px] flex items-center justify-center">
<p id="question-text" class="text-lg md:text-xl text-center font-semibold"></p>
</div>
<div id="options-container" class="grid grid-cols-1 gap-3"></div>
<div id="explanation-container" class="hidden mt-4 p-3 bg-gray-800/70 rounded-lg text-sm">
<h4 id="explanation-title" class="font-bold text-purple-300 mb-1"></h4>
<p id="explanation-text" class="text-gray-300"></p>
</div>
<div id="navigation-container" class="flex justify-between mt-4">
<button id="prev-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg btn text-sm"></button>
<button id="home-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg btn text-sm"></button>
<button id="next-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg btn text-sm"></button>
</div>
</div>


<div id="results-screen" class="hidden text-center p-8 rounded-2xl shadow-2xl card">
<h2 id="results-title" class="text-2xl font-bold mb-4 text-purple-400"></h2>
<p id="final-score-text" class="text-xl mb-4"></p>
<div class="flex flex-col gap-4">
<button id="play-again-btn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg text-lg btn shadow-lg"></button>
<button id="share-score-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg text-lg btn shadow-lg mt-2"></button>
<button id="whatsapp-channel-btn-results" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 px-6 rounded-lg text-lg btn shadow-lg mt-4 whatsapp-glow-btn">
Join Our WhatsApp Channel
</button>
<button id="home-btn-results" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-lg btn shadow-lg"></button>
</div>
</div>


<div id="loader" class="hidden text-center p-8">
<div class="flex justify-center items-center">
<div class="animate-spin rounded-full h-12 w-12 border-b-4 border-purple-400"></div>
</div>
<p id="loader-text" class="mt-4 text-base"></p>
</div>


<div id="message-box" class="hidden fixed top-5 right-5 bg-red-500 text-white py-2 px-4 rounded-lg shadow-lg animate-pulse z-50">
<p id="message-text"></p>
</div>
</div>
</div>


<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
const langScreen = document.getElementById('language-selection-screen');
const startScreen = document.getElementById('start-screen');
const quizScreen = document.getElementById('quiz-screen');
const resultsScreen = document.getElementById('results-screen');
const loader = document.getElementById('loader');


const langEnBtn = document.getElementById('lang-en-btn');
const langHiBtn = document.getElementById('lang-hi-btn');
const startBtn = document.getElementById('start-btn');
const playAgainBtn = document.getElementById('play-again-btn');
const prevBtn = document.getElementById('prev-btn');
const nextBtn = document.getElementById('next-btn');
const homeBtn = document.getElementById('home-btn');
const homeBtnResults = document.getElementById('home-btn-results');
const shareScoreBtn = document.getElementById('share-score-btn');
const whatsappChannelBtnResults = document.getElementById('whatsapp-channel-btn-results');


const menuToggleBtn = document.getElementById('menu-toggle-btn');
const sideMenu = document.getElementById('side-menu');
const closeMenuBtn = document.getElementById('close-menu-btn');
const menuTitle = document.getElementById('menu-title');
const menuHomeBtn = document.getElementById('menu-home-btn');
const menuDescriptionBtn = document.getElementById('menu-description-btn');
const menuHelpBtn = document.getElementById('menu-help-btn');
const menuContent = document.getElementById('menu-content');
const menuContentTitle = document.getElementById('menu-content-title');
const menuContentText = document.getElementById('menu-content-text');


const topicInput = document.getElementById('topic-input');
const questionsCountInput = document.getElementById('questions-count-input');
const difficultyInput = document.getElementById('difficulty-input');
const difficultyLabel = document.getElementById('difficulty-label');
const questionText = document.getElementById('question-text');
const optionsContainer = document.getElementById('options-container');
const explanationContainer = document.getElementById('explanation-container');
const explanationText = document.getElementById('explanation-text');
const progressText = document.getElementById('progress-text');
const scoreDisplay = document.getElementById('score-display');
const timerDisplay = document.getElementById('timer-display');
const finalScoreText = document.getElementById('final-score-text');
const historyContainer = document.getElementById('history-container');
const topicHistoryList = document.getElementById('topic-history');
const messageBox = document.getElementById('message-box');
const messageText = document.getElementById('message-text');


let questions = [];
let userAnswers = [];
let currentQuestionIndex = 0;
let score = 0;
let currentLanguage = 'en';
let currentTopic = '';
let timer = null;
let timeLeft = 15;


const audioContext = new (window.AudioContext || window.webkitAudioContext)();


function playSound(frequency, type, duration = 0.1) {
const oscillator = audioContext.createOscillator();
const gainNode = audioContext.createGain();


oscillator.type = type;
oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);


gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);


oscillator.connect(gainNode);
gainNode.connect(audioContext.destination);


oscillator.start();
oscillator.stop(audioContext.currentTime + duration);
}


const uiStrings = {
'en': {
mainTitle: 'AI-Powered Quiz Game',
mainSubtitle: 'Test your knowledge on any topic!',
topicPlaceholder: 'Enter any topic (e.g., History of India)',
questionsCountPlaceholder: 'Number of questions (e.g., 10)',
difficultyLabel: 'Select Difficulty',
startBtn: 'Start Quiz',
historyTitle: 'Recent Topics:',
score: 'Score',
questionProgress: 'Question',
timerText: 'Time Left',
explanationTitle: 'Explanation:',
prevBtn: 'Previous',
nextBtn: 'Next',
finishBtn: 'Finish',
homeBtn: 'Back to Home',
resultsTitle: 'Quiz Complete!',
finalScore: 'Your final score is:',
playAgainBtn: 'Play Again',
shareScoreBtn: 'Share Score',
whatsappChannelBtn: 'Join Our WhatsApp Channel',
loaderText: 'AI is generating questions for you...',
errorTopic: 'Please enter a topic.',
errorQuestionCount: 'Please choose between 1 and 500 questions.',
errorAPIFail: 'Failed to generate questions. Please try again.',
apiCountWarning: (count) => `The AI could only generate ${count} questions.`,
timeUp: 'Time is up!',
invalidJson: 'Received invalid data from AI. Please try again.',


menuTitle: 'Menu',
menuHome: 'Home',
menuDescription: 'Description',
menuHelp: 'Help',
descriptionTitle: 'About This Game',
descriptionText: `
<p>Welcome to the AI-Powered Quiz Game! This unique game allows you to test your knowledge on virtually any topic you can imagine like Science, History, Geography, Political Science, Indian Constitution, NCERT books, etc.</p>
<p>Simply enter a topic, choose the number of questions and difficulty level, and our advanced AI will generate a custom quiz just for you.</p>
<p>Challenge yourself, learn new facts, and have fun!</p>
`,
helpTitle: 'How to Play',
helpText: `
<p>1. <b>Select Language:</b> Choose your preferred language (English or Hindi) on the first screen.</p>
<p>2. <b>Enter Topic:</b> On the start screen, type any topic you want to be quizzed on (e.g., "Indian History", "Science", "Movies").</p>
<p>3. <b>Set Questions & Difficulty:</b> Enter the number of questions you want (1-500) and select the difficulty level (Easy, Medium, Hard).</p>
<p>4. <b>Start Quiz:</b> Click 'Start Quiz' to begin. The AI will generate questions, which may take a few moments.</p>
<p>5. <b>Answer Questions:</b> For each question, select one of the four options. You have 15 seconds per question.</p>
<p>6. <b>Review & Navigate:</b> After answering, the correct answer and an explanation will be shown.
Use 'Previous' and 'Next' buttons to navigate. 'Next' becomes 'Finish' on the last question.</p>
<p>7. <b>View Results:</b> After the last question, your final score will be displayed.
You can play again or go back to the home screen.</p>
<p>8. <b>Share Score:</b> Share your quiz results with friends!</p>
`
},
'hi': {
mainTitle: 'AI-संचालित क्विज़ गेम',
mainSubtitle: 'किसी भी विषय पर अपनी ज्ञान की परीक्षा करें!',
topicPlaceholder: 'कोई विषय दर्ज करें (जैसे: भारत का इतिहास)',
questionsCountPlaceholder: 'प्रश्नों की संख्या (जैसे: 10)',
difficultyLabel: 'कठिनाई स्तर चुनें',
startBtn: 'क्विज़ शुरू करें',
historyTitle: 'पिछला इतिहास:',
score: 'स्कोर',
questionProgress: 'प्रश्न',
timerText: 'बचा हुआ समय',
explanationTitle: 'स्पष्टीकरण:',
prevBtn: 'पिछला',
nextBtn: 'अगला',
finishBtn: 'समाप्त',
homeBtn: 'होम पर वापस',
resultsTitle: 'क्विज़ समाप्त!',
finalScore: 'आपका अंतिम स्कोर है:',
playAgainBtn: 'फिर से खेलें',
shareScoreBtn: 'स्कोर साझा करें',
whatsappChannelBtn: 'हमारे WhatsApp चैनल से जुड़ें',
loaderText: 'AI आपके लिए प्रश्न तैयार कर रहा है...',
errorTopic: 'कृपया एक विषय दर्ज करें।',
errorQuestionCount: 'कृपया 1 और 500 के बीच प्रश्नों की संख्या चुनें।',
errorAPIFail: 'प्रश्न बनाने में विफल। कृपया पुनः प्रयास करें।',
apiCountWarning: (count) => `AI केवल ${count} प्रश्न ही बना सका।`,
timeUp: 'समय समाप्त!',
invalidJson: 'AI से अमान्य डेटा प्राप्त हुआ। कृपया पुनः प्रयास करें।',


menuTitle: 'मेनू',
menuHome: 'होम',
menuDescription: 'विवरण',
menuHelp: 'सहायता',
descriptionTitle: 'इस गेम के बारे में',
descriptionText: `
<p>AI-संचालित क्विज़ गेम में आपका स्वागत है! यह अनोखा गेम आपको विज्ञान, इतिहास, भूगोल, राजनीति विज्ञान, भारतीय संविधान, NCERT की किताबें आदि जैसे लगभग किसी भी विषय पर अपने ज्ञान का परीक्षण करने की सुविधा देता है।</p>
<p>बस एक विषय दर्ज करें, प्रश्नों की संख्या और कठिनाई स्तर चुनें, और हमारा उन्नत AI आपके लिए एक विशेष क्विज़ तैयार कर देगा।</p>
<p>खुद को चुनौती दें, नए तथ्य सीखें और मज़े करें!</p>
`,
helpTitle: 'कैसे खेलें',
helpText: `
<p>1. <b>भाषा चुनें:</b> पहली स्क्रीन पर अपनी पसंदीदा भाषा (अंग्रेजी या हिंदी) चुनें।</p>
<p>2. <b>विषय दर्ज करें:</b> स्टार्ट स्क्रीन पर, आप जिस भी विषय पर क्विज़ खेलना चाहते हैं उसे टाइप करें (जैसे, "भारतीय इतिहास", "विज्ञान", "फिल्में")।</p>
<p>3. <b>प्रश्नों की संख्या और कठिनाई सेट करें:</b> आप जितने प्रश्न चाहते हैं (1-500) दर्ज करें और कठिनाई स्तर (आसान, मध्यम, कठिन) चुनें।</p>
<p>4. <b>क्विज़ शुरू करें:</b> क्विज़ शुरू करें पर क्लिक करें। AI प्रश्न तैयार करेगा, जिसमें कुछ क्षण लग सकते हैं।</p>
<p>5. <b>प्रश्नों का उत्तर दें:</b> प्रत्येक प्रश्न के लिए, चार विकल्पों में से एक चुनें।
आपके पास प्रति प्रश्न 15 सेकंड हैं।</p>
<p>6. <b>समीक्षा करें और नेविगेट करें:</b> उत्तर देने के बाद, सही उत्तर और एक स्पष्टीकरण दिखाया जाएगा।
नेविगेट करने के लिए 'पिछला' और 'अगला' बटन का उपयोग करें। अंतिम प्रश्न पर 'अगला' बटन 'समाप्त' में बदल जाएगा।</p>
<p>7. <b>परिणाम देखें:</b> अंतिम प्रश्न के बाद, आपका अंतिम स्कोर प्रदर्शित होगा।
आप फिर से खेल सकते हैं या होम स्क्रीन पर वापस जा सकते हैं।</p>
<p>8. <b>स्कोर साझा करें:</b> अपने क्विज़ परिणामों को दोस्तों के साथ साझा करें!</p>
`
}
};


function shuffleArray(array) {
for (let i = array.length - 1; i > 0; i--) {
const j = Math.floor(Math.random() * (i + 1));
[array[i], array[j]] = [array[j], array[i]];
}
}


function startTimer() {
clearTimer();
timeLeft = 15;
timerDisplay.textContent = `${uiStrings[currentLanguage].timerText}: ${timeLeft}s`;
timerDisplay.classList.remove('low-time');


timer = setInterval(() => {
timeLeft--;
timerDisplay.textContent = `${uiStrings[currentLanguage].timerText}: ${timeLeft}s`;


if (timeLeft <= 5) {
timerDisplay.classList.add('low-time');
} else {
timerDisplay.classList.remove('low-time');
}


if (timeLeft <= 0) {
clearTimer();
if (userAnswers[currentQuestionIndex] === null) {
userAnswers[currentQuestionIndex] = { selected: null };
showAnswerResult(userAnswers[currentQuestionIndex]);
showMessage(uiStrings[currentLanguage].timeUp);
}
}
}, 1000);
}


function clearTimer() {
if (timer) {
clearInterval(timer);
timer = null;
}
timerDisplay.classList.remove('low-time');
}


function setLanguage(lang) {
currentLanguage = lang;
document.documentElement.lang = lang;
updateUIText();
langScreen.classList.add('hidden');
startScreen.classList.remove('hidden');
loadTopicHistory();
updateMenuContent('description');
}


function updateUIText() {
const t = uiStrings[currentLanguage];
document.title = t.mainTitle;
document.getElementById('main-title').textContent = t.mainTitle;
document.getElementById('main-subtitle').textContent = t.mainSubtitle;
topicInput.placeholder = t.topicPlaceholder;
questionsCountInput.placeholder = t.questionsCountPlaceholder;
difficultyLabel.textContent = t.difficultyLabel;
startBtn.textContent = t.startBtn;
document.getElementById('history-title').textContent = t.historyTitle;
document.getElementById('explanation-title').textContent = t.explanationTitle;
prevBtn.textContent = t.prevBtn;
nextBtn.textContent = t.nextBtn;
homeBtn.textContent = t.homeBtn;
homeBtnResults.textContent = t.homeBtn;
document.getElementById('results-title').textContent = t.resultsTitle;
playAgainBtn.textContent = t.playAgainBtn;
shareScoreBtn.textContent = t.shareScoreBtn;
whatsappChannelBtnResults.textContent = t.whatsappChannelBtn;


menuTitle.textContent = t.menuTitle;
menuHomeBtn.textContent = t.menuHome;
menuDescriptionBtn.textContent = t.menuDescription;
menuHelpBtn.textContent = t.menuHelp;
if (!sideMenu.classList.contains('hidden')) {
const activeMenuSection = menuContentText.dataset.activeSection || 'description';
updateMenuContent(activeMenuSection);
}
}


function showMessage(message) {
messageText.textContent = message;
messageBox.classList.remove('hidden');
setTimeout(() => messageBox.classList.add('hidden'), 3000);
}


async function startGame() {
const topic = topicInput.value.trim();
const questionCount = parseInt(questionsCountInput.value);
const difficulty = difficultyInput.value;
currentTopic = topic;


if (!topic) {
showMessage(uiStrings[currentLanguage].errorTopic);
return;
}
if (isNaN(questionCount) || questionCount < 1 || questionCount > 500) {
showMessage(uiStrings[currentLanguage].errorQuestionCount);
return;
}


startScreen.classList.add('hidden');
loader.classList.remove('hidden');


try {
await fetchQuizData(topic, questionCount, difficulty);
saveTopicHistory(topic);


loader.classList.add('hidden');
quizScreen.classList.remove('hidden');


currentQuestionIndex = 0;
score = 0;
userAnswers = new Array(questions.length).fill(null);
scoreDisplay.textContent = `${uiStrings[currentLanguage].score}: 0`;


displayQuestion();
} catch (error) {
console.error('Error during quiz generation or API call:', error);
showMessage(error.message || uiStrings[currentLanguage].errorAPIFail);
loader.classList.add('hidden');
startScreen.classList.remove('hidden');
}
}


async function fetchQuizData(topic, count, difficulty, retries = 3, delay = 1000) {
const langInstruction = currentLanguage === 'hi'
? `सभी टेक्स्ट (प्रश्न, विकल्प, उत्तर, स्पष्टीकरण) केवल हिंदी में होने चाहिए।`
: `All text (question, options, answer, explanation) must be in English.`;
const difficultyInstruction = `Questions should be of ${difficulty} difficulty level.`;


const prompt = `Create a multiple-choice quiz on the topic "${topic}". It should have ${count} questions.
Provide output in JSON format. The JSON should be an array of objects.
Each object must have four keys: 'question' (string), 'options' (an array of 4 strings), 'answer' (the correct answer string), and 'explanation' (a brief explanation of the correct answer).
${langInstruction} ${difficultyInstruction} Return only the JSON object, no other text.`;


const payload = {
contents: [{ role: "user", parts: [{ text: prompt }] }],
generationConfig: {
responseMimeType: "application/json",
responseSchema: {
type: "ARRAY",
items: {
type: "OBJECT",
properties: {
"question": { "type": "STRING" },
"options": { "type": "ARRAY", "items": { "type": "STRING" } },
"answer": { "type": "STRING" },
"explanation": { "type": "STRING" }
},
required: ["question", "options", "answer", "explanation"]
}
}
}
};


const apiKey = "AIzaSyBLw7RbzlVYQyDEiTnCpv0lby878ds2nqY";
const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;


for (let i = 0; i < retries; i++) {
try {
const response = await fetch(apiUrl, {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify(payload)
});


if (!response.ok) {
if (response.status >= 500 || response.status === 429) {
if (i < retries - 1) {
await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
continue;
}
}
throw new Error(`API Error: ${response.status} ${response.statusText}`);
}


const result = await response.json();


if (result.candidates && result.candidates[0] && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts[0].text) {
try {
const jsonText = result.candidates[0].content.parts[0].text;
questions = JSON.parse(jsonText);
if (!Array.isArray(questions) || questions.length === 0) {
throw new Error(uiStrings[currentLanguage].invalidJson);
}
shuffleArray(questions);


if (questions.length < count) {
showMessage(uiStrings[currentLanguage].apiCountWarning(questions.length));
}
return;
} catch (parseError) {
console.error('JSON parsing error:', parseError);
throw new Error(uiStrings[currentLanguage].invalidJson);
}
} else {
throw new Error(uiStrings[currentLanguage].errorAPIFail);
}
} catch (error) {
if (i === retries - 1) {
throw error;
}
console.warn(`Attempt ${i + 1} failed, retrying...`, error);
}
}
}


function displayQuestion() {
clearTimer();
explanationContainer.classList.add('hidden');
optionsContainer.innerHTML = '';


const currentQuestion = questions[currentQuestionIndex];
questionText.textContent = currentQuestion.question;
progressText.textContent = `${uiStrings[currentLanguage].questionProgress} ${currentQuestionIndex + 1} / ${questions.length}`;


const shuffledOptions = [...currentQuestion.options];
shuffleArray(shuffledOptions);


shuffledOptions.forEach(option => {
const button = document.createElement('button');
button.textContent = option;
button.classList.add('option-btn', 'w-full', 'p-3', 'md:p-4', 'rounded-lg', 'text-left', 'bg-gray-700', 'hover:bg-gray-600', 'border-2', 'border-transparent', 'focus:outline-none', 'focus:border-purple-500', 'transition-colors', 'text-base');
button.addEventListener('click', () => handleOptionClick(option, button));
optionsContainer.appendChild(button);
});


if (userAnswers[currentQuestionIndex] !== null) {
showAnswerResult(userAnswers[currentQuestionIndex]);
} else {
startTimer();
}


prevBtn.style.visibility = currentQuestionIndex === 0 ? 'hidden' : 'visible';
nextBtn.textContent = currentQuestionIndex === questions.length - 1 ? uiStrings[currentLanguage].finishBtn : uiStrings[currentLanguage].nextBtn;
}


function handleOptionClick(selectedOption, clickedButton) {
if (userAnswers[currentQuestionIndex] !== null) return;


clearTimer();
userAnswers[currentQuestionIndex] = { selected: selectedOption };


if (selectedOption.trim() === questions[currentQuestionIndex].answer.trim()) {
score++;
scoreDisplay.textContent = `${uiStrings[currentLanguage].score}: ${score}`;
playSound(600, 'sine');
} else {
playSound(200, 'square');
}


showAnswerResult(userAnswers[currentQuestionIndex]);
}


function showAnswerResult(answerData) {
clearTimer();
const correctAnswer = questions[currentQuestionIndex].answer;
const allOptionButtons = optionsContainer.querySelectorAll('.option-btn');


allOptionButtons.forEach(btn => {
btn.disabled = true;
const btnText = btn.textContent.trim();
if (btnText === correctAnswer.trim()) {
btn.classList.add('correct');
}
if (answerData.selected && btnText === answerData.selected.trim() && btnText !== correctAnswer.trim()) {
btn.classList.add('incorrect');
}
});


explanationText.textContent = questions[currentQuestionIndex].explanation;
explanationContainer.classList.remove('hidden');
}


function goToPreviousQuestion() {
if (currentQuestionIndex > 0) {
currentQuestionIndex--;
displayQuestion();
}
}


function goToNextQuestion() {
if (currentQuestionIndex < questions.length - 1) {
currentQuestionIndex++;
displayQuestion();
} else {
showResults();
}
}


function showResults() {
clearTimer();
quizScreen.classList.add('hidden');
resultsScreen.classList.remove('hidden');
finalScoreText.innerHTML = `${uiStrings[currentLanguage].finalScore} <br> <span class="text-3xl md:text-4xl font-bold text-green-400 mt-2 inline-block">${score} / ${questions.length}</span>`;
}


function shareScore() {
const shareText = `${uiStrings[currentLanguage].finalScore} ${score} / ${questions.length} on the AI-Powered Quiz Game! Topic: ${currentTopic}. Can you beat my score?`;


if (navigator.share) {
navigator.share({
title: uiStrings[currentLanguage].mainTitle,
text: shareText,
url: window.location.href
}).catch((error) => console.error('Error sharing:', error));
} else {
showMessage('Web Share API not supported. You can manually copy your score: ' + shareText);
console.log('Share fallback: ' + shareText);
}
}


function resetGame() {
clearTimer();
langScreen.classList.remove('hidden');
startScreen.classList.add('hidden');
quizScreen.classList.add('hidden');
resultsScreen.classList.add('hidden');
loader.classList.add('hidden');
sideMenu.classList.add('hidden', '-translate-x-full');


topicInput.value = '';
questionsCountInput.value = '';
difficultyInput.value = 'easy';
questions = [];
userAnswers = [];
currentQuestionIndex = 0;
score = 0;
currentTopic = '';
}


function getHistory() {
const historyKey = `quizTopicHistory_${currentLanguage}`;
const history = localStorage.getItem(historyKey);
return history ? JSON.parse(history) : [];
}


function loadTopicHistory() {
const history = getHistory();
topicHistoryList.innerHTML = '';
if (history.length === 0) {
historyContainer.classList.add('hidden');
return;
}


historyContainer.classList.remove('hidden');
history.forEach(topic => {
const li = document.createElement('li');
li.textContent = topic;
li.className = 'p-2 rounded-md text-gray-300';
li.addEventListener('click', () => {
topicInput.value = topic;
});
topicHistoryList.prepend(li);
});
}


function saveTopicHistory(topic) {
let history = getHistory();
history = history.filter(t => t.toLowerCase() !== topic.toLowerCase());
history.unshift(topic);
if (history.length > 10) history.pop();
const historyKey = `quizTopicHistory_${currentLanguage}`;
localStorage.setItem(historyKey, JSON.stringify(history));
loadTopicHistory();
}


function toggleMenu() {
sideMenu.classList.toggle('hidden');
sideMenu.classList.toggle('open');
sideMenu.classList.toggle('-translate-x-full');
}


function updateMenuContent(section) {
const t = uiStrings[currentLanguage];
menuContentText.dataset.activeSection = section;


const existingWhatsappButton = document.getElementById('whatsapp-channel-btn-menu');
if (existingWhatsappButton) {
existingWhatsappButton.remove();
}


if (section === 'description') {
menuContentTitle.textContent = t.descriptionTitle;
menuContentText.innerHTML = t.descriptionText;


let whatsappButtonInMenu = document.createElement('button');
whatsappButtonInMenu.id = 'whatsapp-channel-btn-menu';
whatsappButtonInMenu.textContent = t.whatsappChannelBtn;
whatsappButtonInMenu.classList.add('w-full', 'bg-emerald-500', 'hover:bg-emerald-600', 'text-white', 'font-bold', 'py-3', 'px-6', 'rounded-lg', 'text-lg', 'btn', 'shadow-lg', 'mt-4', 'whatsapp-glow-btn');


menuContentText.appendChild(whatsappButtonInMenu);


whatsappButtonInMenu.addEventListener('click', () => {
window.open('https://whatsapp.com/channel/0029Vb6ZMmI3wtb6E8Jw3w28', '_blank');
});
} else if (section === 'help') {
menuContentTitle.textContent = t.helpTitle;
menuContentText.innerHTML = t.helpText;
}
}


langEnBtn.addEventListener('click', () => setLanguage('en'));
langHiBtn.addEventListener('click', () => setLanguage('hi'));
startBtn.addEventListener('click', startGame);
playAgainBtn.addEventListener('click', resetGame);
prevBtn.addEventListener('click', goToPreviousQuestion);
nextBtn.addEventListener('click', goToNextQuestion);
homeBtn.addEventListener('click', resetGame);
homeBtnResults.addEventListener('click', resetGame);
shareScoreBtn.addEventListener('click', shareScore);
whatsappChannelBtnResults.addEventListener('click', () => {
window.open('https://whatsapp.com/channel/0029Vb6ZMmI3wtb6E8Jw3w28', '_blank');
});


menuToggleBtn.addEventListener('click', toggleMenu);
closeMenuBtn.addEventListener('click', toggleMenu);
menuHomeBtn.addEventListener('click', () => {
toggleMenu();
resetGame();
});
menuDescriptionBtn.addEventListener('click', () => updateMenuContent('description'));
menuHelpBtn.addEventListener('click', () => updateMenuContent('help'));


// Adjust the app-container size on window resize
window.addEventListener('resize', () => {
const appContainer = document.getElementById('app-container');
const gameWrapper = document.getElementById('game-wrapper');


// Set the aspect ratio and a max width for desktop view
const maxWidth = 450;
const aspectRatio = 9 / 16;
const currentWidth = Math.min(gameWrapper.clientWidth, maxWidth);


appContainer.style.width = `${currentWidth}px`;
appContainer.style.height = `${currentWidth / aspectRatio}px`;
});


// Initial call to set the size correctly on load
window.dispatchEvent(new Event('resize'));
});
</script>
</body>
</html>